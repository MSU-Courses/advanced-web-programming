# Структутирование кода в PHP

Как уже было сказано, хранить весь код в одном файле — плохая практика. Это делает проект неудобным в поддержке, затрудняет поиск ошибок и усложняет внесение изменений. Поэтому важно разбивать код на отдельные файлы и структурировать его.

Однако при организации файлов и папок в проекте часто возникает вопрос: как правильно это делать?

Сам язык программирования PHP не накладывает ограничений на структуру проекта. Это даёт разработчику полную свободу в выборе подходящего способа организации файлов. При этом, хотя нет единого стандарта, существуют общепринятые принципы, которые помогут вам создать понятную, удобную и легко поддерживаемую структуру проекта.

В этой главе мы рассмотрим основные принципы структурирования кода в PHP, но не будем углубляться в архитектурные шаблоны (MVC, MVP, MVVM, Domain Driven Design и т.д.) — им будет посвящена отдельная глава.

## Основные принципы структурирования кода

Грамотное структурирование проекта в PHP — это важный шаг, который позволяет сделать код читаемым, организованным и удобным для поддержки. Независимо от размера проекта, разделение файлов по их назначению помогает избежать хаоса и упростить разработку.

### Минимальная структура проекта

Для небольших проектов, таких как сайт-визитка или простой блог, часто достаточно простой структуры, которая помогает разделить код по функциональным блокам. Такая организация облегчает поиск ошибок и поддержание кода, так как каждая часть проекта имеет своё назначение. Пример минимальной структуры проекта:

```
project/
├── index.php           # Главная страница
├── about.php           # Страница "О нас"
├── blog.php            # Страница блога
├── contact.php         # Страница контактов
├── includes/           # Вспомогательные файлы
│   ├── partials/       # Части страниц (например, header и footer)
│   ├── functions.php   # Общие функции, чтобы не повторять код
│   └── config.php      # Конфигурация проекта (настройки подключения к БД, константы и т.д.)
└── assets/             # Ресурсы: стили, скрипты, изображения
    ├── css/
    │   └── style.css
    ├── js/
    │   └── script.js
    └── images/
```

Преимущества такой структуры:

- **Логическое разделение кода**. Каждая страница имеет отдельный файл, что упрощает внесение изменений.
- **Избежание дублирования**. Общие функции и настройки вынесены в отдельные файлы (functions.php, config.php), что позволяет использовать их повторно.
- **Удобство работы с ресурсами**. Все статические файлы (CSS, JS, изображения) собраны в одной папке assets/.

> [!TIP]
> Слово `assets` переводится как «ресурсы», то есть файлы, необходимые для оформления и функционала сайта.

### Более организованная структура

Когда проект растёт и функционал расширяется, рекомендуется использовать более сложную организацию файлов и папок. Такой подход помогает чётко разграничить публичные файлы, внутреннюю логику и конфигурацию, повышая безопасность и упрощая поддержку.

Один из популярных стандартов для PHP-проектов — шаблон Skeleton[^1], который предлагает следующую _root-структуру_ (структуру корневой директории):

```
project/
├── bin/                # Исполняемые файлы (скрипты для администрирования, утилиты)
├── config/             # Файлы конфигурации (настройки подключения, константы)
├── docs/               # Документация проекта
├── public/             # Публичные файлы (точка входа, assets)
├── resources/          # Внутренние ресурсы (шаблоны, переводы, файлы данных)
├── src/                # Исходный код (классы, функции, бизнес-логика)
└── tests/              # Тесты для проверки функционала
```

Несмотря на множество директорий, мы рассмотрим ключевые, которые помогут вам лучше понять организацию проекта.

> [!NOTE]
> Данная структура является рекомендованной, но не обязательной, и может адаптироваться в зависимости от проекта, используемых технологий и требований.

### Директория `public`

Директория `public/` предназначена для размещения файлов, доступных напрямую из браузера. Это может быть, как отдельные страницы, так и статические файлы (CSS, JS, изображения).

#### Структура `public/`

```
project/
└── public/
    ├── index.php        # Главная страница и точка входа
    ├── about.php        # Страница "О нас"
    ├── blog.php         # Страница блога
    ├── contact.php      # Страница контактов
    ├── article/         # Раздел со статьями
    │   ├── index.php    # Страница отдельной статьи
    │   └── create.php   # Форма для добавления статьи
    └── assets/          # Статические файлы
        ├── css/
        ├── js/
        └── images/
```

#### Назначение `public/`

- **Безопасность**: файлы конфигурации и основная логика не доступны напрямую.
- **Разделение публичных файлов** от внутренних (_например_, `src/` и `config/`).

В текущей структуре каждая страница имеет отдельный файл (`index.php`, `about.php`, `contact.php`). Это удобно для небольших проектов, но по мере роста приложения управлять страницами вручную становится сложнее. В таких случаях рекомендуется использовать единую точку входа, которая позволит централизовать обработку всех запросов. О ней будет рассказано в следующих разделах.

#### Настройка веб-сервера

Важно понимать, что по умолчанию веб-сервер ищет файл `index.php` в корне сайта. Если файлы проекта находятся в папке `public/`, а сервер настроен на корневую директорию проекта, файлы внутри `public/` не будут загружаться корректно.

Чтобы указать веб-серверу, что корневой каталог проекта — `public/`, необходимо выполнить соответствующую настройку.

Если вы используете встроенный в PHP веб-сервер (подходит для локальной разработки), его можно запустить следующей командой:

```bash
php -S localhost:8000 -t public/
```

- Флаг `-t` (document root) указывает, что `public/` является корневой папкой для веб-сервера.
- После запуска сервер будет доступен по адресу `http://localhost:8000/`.
- Запросы к `http://localhost:8000/index.php` или `http://localhost:8000/about.php` будут автоматически обрабатываться из `public/`.

Если вы используете _XAMPP_ (или другой аналогичный пакет) , где используется веб-сервер Apache, то настройку можно выполнить через `.htaccess`:

1. Создайте файл `.htaccess` внутри папки `public/` и добавьте в него:

   ```apache
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.php?$1 [L,QSA]
   ```

2. Перезапустите XAMPP.

### Директория `src`

Директория `src/` предназначена для хранения основной логики приложения. Здесь размещается весь код, отвечающий за логику приложения, обработку данных и взаимодействие между компонентами. Поскольку файлы из этой папки не доступны напрямую из браузера, это повышает безопасность и позволяет отделить внутреннюю логику от публичных ресурсов.

Несмотря на то, что файлы из `src/` недоступны напрямую, их можно подключать к публичным файлам (например, `index.php`). Это означает, что доступ к файлам внутри `src/` через браузер невозможен, однако они могут быть использованы внутри приложения.

#### Структура `src/`

​Структура директории `src/` может значительно различаться в зависимости от размера и сложности проекта.

_Например_, для небольших проектов, она может быть "плоской" и содержать файлы по типу:

```
project/
└── src/
    ├── database.php   # Работа с базой данных (подключение, выполнение запросов)
    ├── functions.php  # Общие функции, используемые по всему приложению
    ├── users.php      # Логика, связанная с пользователями (регистрация, авторизация)
    └── ...
```

Для более крупных проектов рекомендуется разделить код на несколько подпапок для лучшей организации. _Например_:

```
project/
└── src/
    ├── functions/     # Общие функции
    │   ├── helpers.php      # Вспомогательные функции
    │   └── validation.php   # Функции валидации данных
    ├── database/      # Работа с базой данных
    │   ├── connection.php   # Подключение к БД
    │   └── queries.php      # SQL-запросы
    ├── handlers/      # Обработчики запросов (например, формы регистрации, входа)
    │   ├── register.php     # Обработка регистрации
    │   ├── login.php        # Обработка авторизации
    │   └── article_create.php   # Добавление новой статьи
    └── ...
```

Директорию `src/` можно также разделять на модули (например, `core/`, `auth/`, `blog/`, `admin/`), каждый из которых отвечает за свою часть функционала и может содержать собственные поддиректории и файлы:

```
project/
└── src/
    ├── core/               # Основные компоненты приложения
    │   ├── app.php         # Инициализация приложения
    │   └── ...
    ├── auth/               # Авторизация и аутентификация
    │   ├── handlers/       # Обработчики запросов
    │   ├── validators/     # Валидаторы данных
    │   └── ...
    ├── blog/               # Блог
    │   ├── handlers/       # Обработчики запросов
    │   ├── validators/     # Валидаторы данных
    │   └── ...
    └── ...
```

#### Назначение `src/`

- **Чёткое разделение логики** (не смешивать с публичными файлами).
- **Упрощает поддержку кода**, если проект растёт.

#### Рекомендации по организации структуры `src/`

- **Согласованность**. Придерживайтесь единого стиля именования файлов и директорий. *Например*, используйте либо `snake_case`, либо `camelCase` для имен файлов и папок.​
- **Четкое разделение ответственности**. Каждый модуль или папка должны иметь четко определенную ответственность. Это облегчает навигацию по проекту и упрощает процесс разработки.​
- **Документация**. Обеспечьте наличие документации для каждого модуля или компонента, чтобы новые участники команды могли быстро понять структуру и функциональность проекта.​

### Директория `config`

**Конфигурация** — это набор настроек, которые используются в проекте. Это могут быть параметры подключения к базе данных, настройки приложения, и другие настройки.

Директория `config.php` предназначена для хранения всех настроек приложения. Здесь располагаются файлы, которые содержат параметры подключения к базе данных, глобальные константы, режим отладки и другие важные настройки, используемые по всему проекту. Главное преимущество такого подхода – возможность вносить изменения в конфигурацию без необходимости редактирования основной логики кода.

#### Структура `config/`

```
project/
└── config/
    ├── app.php          # Основные настройки приложения (название, URL, режим отладки)
    └── database.php     # Настройки подключения к базе данных (хост, логин, пароль, имя базы данных)
```

#### Назначение `config/`

- Изменения настроек **не требуют редактирования кода** в других файлах.
- Конфигурация **гибко управляется из одного места**.

#### Примеры конфигурационных файлов

Рассмотрим несколько примеров конфигурационных файлов. _Например_, для общих настроек приложения:

```php
<?php

// config/app.php

define('APP_NAME', 'My App');           // Название приложения
define('APP_URL', 'http://localhost');  // URL приложения
define('APP_DEBUG', true);              // Режим отладки
```

После чего в других файлах можно использовать эти константы:

```php
<?php

// src/functions/helpers.php

require '../config/app.php';

/**
 * Получить заголовок страницы
 *
 * @param string $title Заголовок страницы
 * @return string
 */
function getTitle(string $title): string
{
    return $title . ' | ' . APP_NAME;
}
```

### Директория `resources`

Директория `resources/` предназначена для хранения внутренних ресурсов, которые используются приложением, но не должны быть доступны напрямую из браузера. Это могут быть шаблоны, переводы, компоненты интерфейса, а также другие файлы данных, необходимые для формирования финального результата.

#### Структура `resources/`

```
project/
└── resources/
    ├── components/       # Повторно используемые элементы интерфейса (например, карточки, формы)
    ├── lang/             # Файлы локализации (переводы на разные языки)
    └── views/            # Шаблоны страниц или отдельных компонентов (HTML)
```

#### Назначение `resources/`

- **Безопасность**: файлы внутри `resources/` не доступны напрямую из браузера.
- **Централизованное управление ресурсами**. Все внутренние данные проекта хранятся в одном месте.

[^1]: _Skeleton: Standard PHP Package Skeleton_. github.com [online resource]. Available at: https://github.com/php-pds/skeleton
[^2]: _Skeleton Research_. github.com [online resource]. Available at: https://github.com/php-pds/skeleton_research
