# Разделение кода на файлы

Перед тем как писать код, его нужно грамотно структурировать. Представьте ситуацию, что у вас есть проект, который состоит из одного файла, в котором находится весь код. Работать с таким файлом крайне неудобно: приходится постоянно прокручивать его в поисках нужного фрагмента, а процесс отладки и поддержки существенно усложняется. Именно поэтому важно **разбивать код на отдельные файлы**, что делает его более организованным, удобным для работы и легким в сопровождении.

## Зачем разделять код?

1. **Удобство разработки**. Вам будет проще ориентироваться в проекте, если каждая часть кода находится в отдельном месте.
2. **Проще отлаживать**. Найти и исправить ошибку в отдельном файле гораздо легче, чем искать её в “простыне” кода.
3. **Повторное использование**. Вы можете создавать универсальные модули (_например_, для подключения к базе данных), которые легко подключаются в любом месте проекта.
4. **Читаемость**. Другим разработчикам (и даже вам самим через некоторое время) будет легче разобраться в логике работы приложения.

## Способы подключения файлов

В PHP существует **два** способа подключения файлов:

- Выражение `include` – подключает файл и продолжает выполнение скрипта. Если файл не найден, выдаётся предупреждение (warning), но выполнение кода не прерывается [^1].
- Выражение `require` – подключает файл и прерывает выполнение скрипта в случае его отсутствия, вызывая фатальную ошибку (fatal error) [^2].

**Пример**. _Подключение файлов_

Файл `functions.php` содержит функцию сложения двух чисел:

```php
<?php

// functions.php

/**
 * Функция сложения двух чисел
 * @param int $a
 * @param int $b
 * @return int
 */
function sum($a, $b) {
    return $a + $b;
}
```

Подключение файла `functions.php` в `index.php`:

```php
<?php

// index.php

require 'functions.php';

echo sum(2, 3); // 5
```

Если файл `functions.php` отсутствует, выполнение кода должно быть прервано, поэтому используется `require`. Если бы мы применили `include`, то в случае отсутствия файла код продолжил бы выполняться, но функция `sum` не была бы найдена, что привело бы к ошибке.

В PHP существуют парные функции `include_once` [^3] и `require_once` [^4], которые подключают файл только один раз. Это полезно для предотвращения дублирования кода, особенно если один и тот же файл может быть подключён в нескольких местах. Если файл уже был подключён ранее, повторное подключение не произойдёт.

**Пример**. _Подключение файлов с использованием `require_once`_

```php
<?php

// functions.php

require_once 'functions.php';
require_once 'functions.php'; // Файл не будет подключён повторно
```

### Как работает подключение файлов?

Когда PHP встречает одну из директив подключения (`include`, `require`, `include_once`, `require_once`), он открывает указанный файл, считывает его содержимое и вставляет код в текущий контекст выполнения, словно этот код был написан непосредственно в месте подключения

**Пример**. _Как работает подключение файлов_

Если в файле `hello.php` содержится следующий код:

```php
<?php

// hello.php

echo 'Hello, world!';
```

А в файле `index.php` выполняется его подключение:

```php

// index.php

require_once 'hello.php';
```

То при выполнении `index.php` PHP фактически подставит содержимое `hello.php`, и код будет выглядеть так:

```php
<?php

// index.php

echo 'Hello, world!'; // как будто этот код был написан здесь
```

### Какие файлы можно подключать?

В PHP можно подключать не только файлы с кодом (`.php`), но и другие типы файлов, такие как текстовые (`.txt`), HTML-шаблоны (`.html`). Однако важно учитывать, что PHP обрабатывает только `.php`-файлы, а остальные файлы подключаются как обычный текст без выполнения кода.

**Пример**. _Подключение php файлов_

```php
<?php

// index.php

require_once 'config.php';  // Подключение конфигурационного файла
require_once 'header.php';   // Подключение HTML-шаблона
```

Файл `config.php` может содержать конфигурационные константы:

```php
<?php

// config.php

define('APP_NAME', 'My App');
```

Файл `header.php` может содержать HTML-разметку с PHP-кодом:

```php
<?php

// header.php

?>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title><?php echo APP_NAME; ?></title>
</head>
<body>
```

**Пример**. _Подключение файлов других типов_

```php
<?php

// index.php

require_once 'header.html';  // Подключение HTML-файла
```

Файл `header.html` содержит следующий код:

```html
<!-- header.html -->
<header>
  <h1>My App</h1>
</header>
```

При подключении `header.html` его содержимое вставляется в `index.php` как обычный текст и отображается в браузере как HTML-разметка.

Этот механизм позволяет разделять код на отдельные файлы, что значительно упрощает его поддержку и дальнейшее развитие.

### Подключение через относительный путь

**Относительный путь** — это путь к файлу относительно текущего местоположения. Он позволяет указать путь к файлу относительно текущего файла, что удобно при организации файловой структуры проекта.

**Пример**. _Подключение файла через относительный путь_

Рассмотрим следующую структуру проекта:

```
project/
├── includes/
│   └── functions.php
└── public/
    └── index.php
```

Подключение файла `functions.php` в `index.php` через относительный путь:

```php
<?php

// index.php

require_once '../includes/functions.php';
```

> [!NOTE] > `..` означает переход на уровень выше в файловой системе.

## Использование константы `__DIR__`

Для упрощения работы с путями в PHP существует магическая константа `__DIR__`, которая возвращает абсолютный путь к текущему файлу. Это позволяет надежно подключать файлы независимо от того, откуда запускается скрипт.

**Пример**. _Использование константы `__DIR__`_

Рассмотрим структуру проекта:

```
project/
├── includes/
│   └── functions.php
└── public/
    └── index.php
```

Подключение файла `functions.php` в `index.php` с использованием `__DIR__`:

```php
<?php

// index.php

require_once __DIR__ . '/../includes/functions.php';
```

**Как это работает?**

1. `__DIR__` возвращает абсолютный путь к директории, в которой находится текущий файл. Например, если `index.php` расположен по пути:

   - **Windows**: `C:/project/public/index.php`
   - **Linux/macOS**: `/var/www/project/public/index.php`

   То `__DIR__` вернёт соответствующий путь в зависимости от операционной системы:

   - **Windows**: `C:/project/public/`
   - **Linux/macOS**: `/var/www/project/public/`

2. Запись `../includes/functions.php` означает, что сначала нужно подняться на один уровень выше (`..`), затем перейти в директорию `includes` и подключить файл `functions.php`. В результате получается путь:

   - **Windows**: `C:/project/public/../includes/functions.php`
   - **Linux/macOS**: `/var/www/project/public/../includes/functions.php`

3. После обработки `..` путь сокращается до абсолютного:
   - **Windows**: `C:/project/includes/functions.php`
   - **Linux/macOS**: `/var/www/project/includes/functions.php`

Таким образом, независимо от того, где выполняется скрипт, он всегда сможет найти `functions.php`, так как использует абсолютный путь.

[^1]: _include_. php.net [online resource]. Available at: https://www.php.net/manual/ru/function.include.php
[^2]: _require_. php.net [online resource]. Available at: https://www.php.net/manual/ru/function.require.php
[^3]: _include once_. php.net [online resource]. Available at: https://www.php.net/manual/ru/function.include-once.php
[^4]: _require once_. php.net [online resource]. Available at: https://www.php.net/manual/ru/function.require-once.php
