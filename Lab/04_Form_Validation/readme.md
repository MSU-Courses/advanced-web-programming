# Лабораторная работа №4. Валидация форм

## Цель работы

Освоить основные принципы работы с HTML-формами в PHP, включая отправку данных на сервер и их обработку, включая валидацию данных.

Данная работа станет основой для дальнейшего изучения разработки веб-приложений. Дальнейшие лабораторные работы будут основываться на данной.

## Условие

Студенты должны выбрать тему проекта для лабораторной работы, которая будет развиваться на протяжении курса.

**Например**:

- ToDo-лист;
- Блог;
- Система управления задачами;
- другие.

Для данной лабораторной работы в качестве примера используется проект **"Каталог рецептов"**, можно выбрать данную тему.

### Задание 1. Создание проекта

1. Создайте корневую директорию проекта (например, `recipe-book`).
2. Организуйте файловую структуру проекта. _Пример_:
   ```
    recipe-book/
    │── public/                   # Публичная директория (файлы, доступные для веб-сервера)
    │   ├── index.php             # Главная страница (вывод последних рецептов)
    │   ├── recipe/               # Страница добавления рецепта
    │   │   ├── index.php         # Страница с отображением рецептов
    │   │   ├── create.php        # Форма добавления рецепта
    │── src/                      # Исходный код приложения
    │   ├── handlers/             # Обработчики форм
    │   │   ├── recipe-handler.php # Логика обработки формы добавления рецепта
    │   ├── functions.php         # Вспомогательные функции для обработки данных
    │── storage/                  # Хранилище данных
    │   ├── recipes.txt           # Файл для хранения рецептов (JSON-формат)
    │── README.md                 # Описание проекта
   ```

> [!TIP]
> Можно использовать свою структуру, но она должна быть логичной и удобной.

### Задание 2. Создание формы добавления рецепта

1. На странице `public/recipe/create.php` создайте HTML-форму для добавления рецепта.
2. Форма должна содержать следующие поля:
   - Название рецепта (`<input type="text">`);
   - Категория рецепта (`<select>`);
   - Ингредиенты (`<textarea>`);
   - Описание рецепта (`<textarea>`);
   - Тэги (выпадающий список с возможностью выбора нескольких значений, `<select multiple>`).
3. Добавьте поле для **шагов приготовления рецепта**. Реализуйте один из двух вариантов:
   - **Простой вариант**: `<textarea>`, где каждый шаг начинается с новой строки.
   - **Расширенный вариант (на более высокую оценку)**: динамическое добавление шагов с помощью JavaScript (кнопка "Добавить шаг"), где каждый шаг — отдельное поле ввода.
4. Добавьте кнопку **"Отправить"** для отправки формы.

### Задание 3. Обработка формы

1. Создайте в директории `src/handlers/` файл `recipe-handler.php`, который будет обрабатывать данные формы.
2. **В обработчике реализуйте**:
   - Фильрацию данных;
   - Валидацию данных;
   - Сохранение данных в файл `storage/recipes.txt` в формате JSON.
3. Чтобы избежать дублирования кода и улучшить его читаемость, рекомендуется вынести повторяющиеся операции в отдельные вспомогательные функции, разместив их в файле `src/functions.php`.
4. После успешного сохранения данных выполните перенаправление пользователя на главную страницу.
5. Если валидация не пройдена, отобразите соответствующие ошибки на странице добавления рецепта под соответствующими полями.

Для сохранения данных в файл можно использовать разные подходы. Один из вариантов — сохранять данные в текстовый файл, где каждая строка представляет собой отдельный JSON-объект:

```php
$formData = // данные формы;

// валидация данных

file_put_contents('<filename>', json_encode($formData) . PHP_EOL, FILE_APPEND);
```

### Задание 4. Отображение рецептов

1. В файле `public/index.php` отобразите 2 последних рецепта из `storage/recipes.txt`:

   ```php
   // Читаем данные из файла
   $recipes = file('<filename>', FILE_IGNORE_NEW_LINES);

   // Преобразуем строки JSON в массив
   $recipes = array_map('json_decode', $recipes);

   // Получаем два последних рецепта
   $latestRecipes = array_slice($recipes, -2);
   ```

2. В файле `public/recipe/index.php` отобразите все рецепты из файла `storage/recipes.txt`.

### Дополнительное задание

1. Реализуйте пагинацию (постраничный вывод) списка рецептов.
2. На странице `public/recipe/index.php` отображайте по 5 рецептов на страницу.
3. Для этого используйте GET-параметр page, например:
   - `/recipe/index.php?page=2` — отобразить 2 страницу рецептов.
   - `/recipe/index.php?page=3` — отобразить 3 страницу рецептов.
   - Если страница не указана, отобразите первую страницу.

## Документация кода

Код должен быть корректно задокументирован, используя стандарт `PHPDoc`. Каждая функция и метод должны быть описаны с указанием их входных параметров, выходных данных и описанием функционала. Комментарии должны быть понятными, четкими и информативными, чтобы обеспечить понимание работы кода другим разработчикам.

## Контрольные вопросы

1. Какие методы HTTP применяются для отправки данных формы?
2. Что такое валидация данных, и чем она отличается от фильтрации?
3. Какие функции PHP используются для фильтрации данных?
