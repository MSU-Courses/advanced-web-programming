# Функции в PHP

**Функции в PHP** представляют собой блоки кода, которые выполняют определённые действия. Они позволяют структурировать и упростить код, делая его более понятным, удобным для поддержки и повторного использования [^1].

## Объявление функций

Для создания функции в PHP используется ключевое слово `function` [^2].

```php
function functionName(type $arg1, type $arg2, ..., type $argN): return_type {
    // Тело функции
    return $returnValue;
}
```

- `function` — ключевое слово, обозначающее начало объявления функции.
- `functionName` — имя функции, уникальное в пределах одного пространства имён.
- `type` — тип аргумента (может быть скалярным типом, массивом, объектом, интерфейсом, или `callable`).
- `$arg1, $arg2, ..., $argN` — аргументы функции, которые передаются при вызове.
- `return_type` — (опционально) — тип возвращаемого значения, определяемый после двоеточия `:`.
- `return` — оператор, возвращающий значение из функции.

**Пример.** _Объявление функции_

Рассмотрим пример функции для сложения двух чисел:

```php
<?php

/**
 * Функция для сложения двух чисел.
 *
 * @param int|float $a Первое число.
 * @param int|float $b Второе число.
 *
 * @return int|float Сумма чисел.
 */
function sum(int|float $a, int|float $b): int|float {
    return $a + $b;
}

// Вызов функции
echo sum(3, 5); // Вывод: 8
echo sum(2.5, 4.5); // Вывод: 7
```

- **Типы аргументов**. Указываем, что `$a` и `$b` могут быть числами (`int` или `float`).
- **Тип возвращаемого значения**. Результат (`int|float`) зависит от типа переданных аргументов.

Внутри функции можно использовать любой PHP-код (операторы, циклы, условия и т. д.), а также другие функции.

## Наименование функций

Правильное наименование функций делает ваш код более читаемым и понятным. Соблюдайте следующие правила:

### Правила наименования функций

Имя должно соответствовать следующим правилам:

- Начинаться с буквы или символа подчеркивания (`_`).
- Содержать только буквы, цифры и символ подчеркивания (`_`).
- Избегать пробелов и специальных символов.
- Функции не чувствительны к регистру. Например, `sum` и `SUM` — это одна и та же функция.
- Не совпадать с ключевыми словами PHP. Например, нельзя использовать такие имена, как `echo`, `if`, `while`.

### Рекомендации по стилю

- Используйте стиль `camelCase` для наименования функций, где первое слово начинается с маленькой буквы, а каждое последующее — с заглавной (например, calculateTotalPrice).
- Выбирайте имена, отражающие суть выполняемой задачи.

### Примеры корректных имён функций

- `calculateTotalPrice` — расчёт общей стоимости.
- `getUserData` — получение данных пользователя.
- `sendEmail` — отправка электронной почты.
- `validateForm` — проверка формы.

## Вызов функций

Для вызова функции используется имя функции и круглые скобки `()` с передачей аргументов.

```php
<?php

function greet(string $name): string {
    return "Привет, $name!";
}

echo greet("Иван"); // Вывод: Привет, Иван!
```

## Область видимости

Область видимости определяет, где можно использовать функции и переменные в PHP.

Функции, объявленные в глобальной области видимости, доступны в любом месте программы. Однако PHP также позволяет создавать функции внутри других функций, что влияет на их область видимости.

**Пример.** _Область видимости_

```php
<?php

function firstFunction() {
    // Объявление функции внутри другой функции
    function secondFunction() {
        echo "Я не существую, пока не вызовут firstFunction().";
    }
}

// Вызов secondFunction() до вызова firstFunction() вызовет ошибку
// secondFunction(); // Ошибка: Call to undefined function

// Вызов firstFunction() приводит к выполнению её кода, включая объявление secondFunction()
// Функцию firstFunction() можно вызвать в любом месте программы
firstFunction();

// Теперь функция secondFunction() доступна
secondFunction(); // Вывод: Я не существую, пока не вызовут firstFunction().
```

> [!NOTE]
> Использование вложенных функций не рекомендуется, так как это может привести к ошибкам и затруднить понимание кода.

## Значения по умолчанию

В PHP можно задавать значения по умолчанию для аргументов функций. Это позволяет вызывать функцию без передачи всех аргументов, упрощая её использование в ситуациях, когда некоторые параметры имеют стандартные значения.

**Синтаксис**:

```php
function functionName(type $arg = value, ...): return_type {
    // Тело функции
    return $returnValue;
}
```

- `type` — тип аргумента (например, `string`, `int`, `array`).
- `$`arg — имя аргумента.
- `value` — значение по умолчанию, которое будет использоваться, если аргумент не передан при вызове функции.

**Пример.** _Значения по умолчанию_

```php
<?php

/**
 * Функция для приветствия пользователя.
 *
 * @param string $name Имя пользователя.
 * @param string $greeting Приветствие (по умолчанию "Привет").
 *
 * @return string Приветствие пользователя.
 */
function greet(string $name, string $greeting = "Привет"): string {
    return "$greeting, $name!";
}

// Вызов функции с двумя аргументами
echo greet("Иван", "Здравствуйте"); // Вывод: Здравствуйте, Иван!

// Вызов функции с одним аргументом
echo greet("Мария"); // Вывод: Привет, Мария!
```

Аргументы со значениями по умолчанию всегда должны идти после аргументов без значений по умолчанию.

_Неправильно_:

```php
function example(string $arg = "value", int $required): string {
    return "$arg, $required";
}
```

_Правильно_:

```php
function example(int $required, string $arg = "value"): string {
    return "$arg, $required";
}
```

## Передача значений по ссылке

По умолчанию в PHP аргументы передаются по значению. Это означает, что функция работает с копией переданного значения, а изменения, произведённые внутри функции, не влияют на оригинальную переменную.

**Пример.** _Передача значений по значению_

```php
<?php

function increment(int $number): void {
    $number++;
}

$number = 5;

increment($number);

// Вывод: 5
// Функция не изменяет значение переменной $number
// Так как аргумент передаётся по значению
echo $number;
```

В этом примере функция `increment` увеличивает копию переменной `$number`, переданную ей в качестве аргумента. Исходное значение переменной `$number` остаётся неизменным.

Чтобы функция могла изменять оригинальную переменную, нужно использовать передачу по ссылке, добавляя символ `&` перед именем аргумента.

**Синтаксис**:

```php
function functionName(type &$arg1, type &$arg2, ...): return_type {
    // Тело функции
    return $returnValue;
}
```

- `&` — указывает, что аргумент передаётся по ссылке.
- `type` — тип аргумента (например, `string`, `int`, `array`).
- `$arg1, $arg2, ...` — аргументы функции.
- `return_type` — тип возвращаемого значения.

**Пример.** _Передача значений по ссылке_

```php
<?php

/**
 * Обновляет конфигурацию приложения.
 *
 * @param array &$config Конфигурационный массив, который нужно обновить.
 * @param string $key Ключ конфигурации.
 * @param mixed $value Новое значение для ключа.
 */
function updateConfig(array &$config, string $key, $value): void {
    $config[$key] = $value;
}

// Изначальная конфигурация
$appConfig = [
    'debug' => false,
    'timezone' => 'UTC',
    'language' => 'en',
];

// Обновление конфигурации
updateConfig($appConfig, 'debug', true);
updateConfig($appConfig, 'language', 'ru');

print_r($appConfig);
```

**Результат работы программы**:

```
Array
(
    [debug] => 1
    [timezone] => UTC
    [language] => ru
)
```

В данном случае переменная `$appConfig` передаётся в функцию `updateConfig` по ссылке. Это позволяет функции напрямую изменять содержимое массива, а изменения сразу же отражаются на оригинальной переменной.

> [!IMPORTANT]
> Используйте передачу по ссылке только при необходимости, так как избыточное её использование может усложнить понимание и отладку кода.

## Переменное количество аргументов

В PHP функции могут принимать переменное количество аргументов. Это полезно, когда заранее неизвестно, сколько параметров будет передано в функцию. Для этого используется оператор `...` (троеточие) перед именем аргумента.

**Синтаксис**:

```php
function functionName(type ...$args): return_type {
    // Тело функции
    return $returnValue;
}
```

- `...` — указывает, что функция может принимать переменное количество аргументов.
- `type` — тип аргумента (например, `string`, `int`, `array`).
- `$args` — имя переменной, в которой будут храниться переданные аргументы.
- `return_type` — тип возвращаемого значения.

Аргументы автоматически собираются в массив, который можно использовать внутри функции.

**Пример.** _Переменное количество аргументов_

```php
<?php

/**
 * Функция для подсчёта суммы всех переданных чисел.
 *
 * @param int ...$numbers Числа для сложения.
 *
 * @return int Сумма чисел.
 */
function sum(int ...$numbers): int {
    // $numbers содержит все переданные аргументы в виде массива
    return array_sum($numbers);
}

// Вызов функции с разным количеством аргументов
echo sum(1, 2, 3, 4); // Вывод: 10
echo sum(5, 10);      // Вывод: 15
echo sum();           // Вывод: 0
```

## Функции переменных

PHP поддерживает концепцию **функций переменных**, которая позволяет вызывать функции через переменные, содержащие их имена. Если переменной присвоено имя функции и за ней следуют круглые скобки, PHP выполнит эту функцию [^3].

**Синтаксис**:

```php
<?php

function functionName() {
    // Тело функции
}

// Присваиваем имя функции переменной
$var = 'functionName';

// Вызываем функцию через переменную
$var();
```

**Пример.** _Функции переменных_

```php
<?php

function sum(int $a, int $b): int {
    return $a + $b;
}

// Присваиваем имя функции переменной
$operation = 'sum';

// Вызываем функцию через переменную
echo $operation(2, 3); // Вывод: 5
```

В этом примере переменной `$operation` присвоено имя функции `sum`, и затем функция вызывается через эту переменную.

### Применение функций переменных

Функции переменных могут быть полезны в следующих случаях:

- **Callback-функции**. Передача функции в качестве аргумента другой функции.
- **Таблицы функций**. Хранение функций в массивах для динамического вызова.
- **Динамическое определение функций**. Выбор функции для выполнения в зависимости от условий.
- **Функции обратного вызова**. Вызов функции, определённой в другом месте программы.

#### 1. Callback-функции

**Callback-функции** позволяют передавать функцию в качестве аргумента другой функции, чтобы вызвать её позже.

**Пример.** _Callback-функции_

```php
<?php

function executeOperation(callable $callback, int $a, int $b): int {
    return $callback($a, $b);
}

function multiply(int $a, int $b): int {
    return $a * $b;
}

// Передаём имя функции в качестве callback
echo executeOperation('multiply', 4, 5); // Вывод: 20
```

#### 2. Динамическое определение функции

Функции переменных полезны, когда выбор функции зависит от условий.

```php
<?php

function greetInEnglish(): string {
    return "Hello!";
}

function greetInSpanish(): string {
    return "¡Hola!";
}

// Выбор функции на основе условия
$language = 'es';
$greet = $language === 'es' ? 'greetInSpanish' : 'greetInEnglish';

echo $greet(); // Вывод: ¡Hola!
```

#### 3. Таблицы функций

Таблицы функций позволяют хранить функции в массивах для динамического вызова.

```php
<?php

function sum(int $a, int $b): int {
    return $a + $b;
}

function multiply(int $a, int $b): int {
    return $a * $b;
}

// Таблица функций
$operations = [
    'sum' => 'sum',
    'multiply' => 'multiply',
];

// Выбор функции из таблицы
$operation = 'sum';

echo $operations[$operation](2, 3); // Вывод: 5
```

## Использование функций в HTML

В PHP функции можно вызывать прямо внутри HTML-кода, вставляя их в теги `<?php ?>`. Это позволяет динамически генерировать содержимое веб-страниц, делая их интерактивными и гибкими.

Рассмотрим пример, где функция используется для вывода приветствия:

**Пример.** _Использование функций в HTML_

```php
<?php
    function printGreeting(string $name): string {
        return "Hello, $name!";
    }
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Пример использования функций в HTML</title>
</head>
<body>
    <h1><?php echo printGreeting("World"); ?></h1>
</body>
</html>
```

**Пример.** _Динамическое создание списка_

```php
<?php
    /**
     * Генерация HTML-списка из массива элементов.
     *
     * @param array $items Массив элементов.
     *
     * @return string HTML-список.
     */
    function generateList(array $items): string {
        $html = "<ul>";
        foreach ($items as $item) {
            $html .= "<li>" . htmlspecialchars($item) . "</li>";
        }
        $html .= "</ul>";
        return $html;
    }
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Динамический список</title>
</head>
<body>
    <h1>Список покупок</h1>
    <?php
        $shoppingList = ["Milk", "Bread", "Apples"];
        echo generateList($shoppingList);
    ?>
</body>
</html>
```

**Результат работы программы**:

<img src="https://imgur.com/811F0vL.png" style="width: 100%; max-width: 800px;" />

**Пример.** _Функция хуманизации времени_

_Функция хуманизации времени позволяет преобразовывать временные интервалы в человеко-читаемые форматы, такие как "2 часа назад" или "3 дня назад"_

```php
<?php

/**
 * Возвращает человеко-читаемую разницу между указанной датой и текущим временем.
 *
 * @param DateTime $date Дата, с которой нужно сравнить текущее время.
 * @return string Человеко-читаемая разница во времени или дата в формате 'Y-m-d', если прошло больше 5 дней.
 */
function humanizeTime(DateTime $date): string
{
    $diff = time() - $date->getTimestamp();

    switch (true) {
        case $diff < 60:
            return "менее минуты назад";

        case $diff < 3600:
            $minutes = intdiv($diff, 60);
            return "$minutes минут назад";

        case $diff < 86400:
            $hours = intdiv($diff, 3600);
            return "$hours часов назад";

        case $diff < 432000:
            $days = intdiv($diff, 86400);
            return "$days дней назад";

        default:
            return $date->format('Y-m-d');
    }
}
?>

<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Пример</title>
</head>

<body>
    <article>
        <h1>Post Title</h1>
        <p>Post content</p>
        <footer>
            <p>Author: John Doe</p>
            <p>Published: <?= humanizeTime(new DateTime('2025-01-16 07:12:00')) ?></p>
        </footer>
    </article>
</body>
?>
```

**Результат работы программы**:

<img src="https://imgur.com/sLSFs4s.png" style="width: 100%; max-width: 800px;" />

[^1]: _User Defined_. php.net [online resource]. Available at: https://www.php.net/manual/en/functions.user-defined.php
[^2]: _Function parameters and arguments_. php.net [online resource]. Available at: https://www.php.net/manual/en/functions.arguments.php
[^3]: _Variable functions_. php.net [online resource]. Available at: https://www.php.net/manual/en/functions.variable-functions.php
