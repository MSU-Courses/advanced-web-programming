# Хранение конфигурации базы данных

Существует множество способов хранения конфигурации (в т.ч. переменные окружения, .env-файлы, YAML, JSON, XML и т.д.), но основное правило одно: **конфигурация — это чувствительная информация, которая не должна быть доступна публично**ю Данные для подключения (логины, пароли, имена баз данных) нельзя оставлять в открытом виде, особенно в публичных репозиториях или в коде, доступном из браузера.

### Хранение в .php файлах

Один из простых и надёжных способов — хранить конфигурацию в `.php-файле`, который возвращает массив настроек. _Например_:

```php
<?php

return [
    'db'       => 'mysql',
    'host'     => 'localhost',
    'user'     => 'root',
    'password' => 'password',
    'database' => 'test',
    'charset'  => 'utf8',
];
```

Такой файл можно подключить через `require_once` и использовать данные из массива:

```php
<?php

<?php

$config = require_once 'config/config.php';

$dsn = sprintf(
    'mysql:host=%s;dbname=%s;charset=%s',
    $config['host'],
    $config['database'],
    $config['charset']
);

$pdo = new PDO($dsn, $config['user'], $config['password']);
```

**Безопасность конфигурационного файла**:

- Поместите файл конфигурации в директорию, недоступную из браузера, например `config/`.
- Убедитесь, что веб-сервер не отдаёт `.php-файлы` в виде текста.
- Добавьте путь к файлу в `.gitignore`, чтобы он не попал в систему контроля версий:
  ```
  # .gitignore
  config/db.php
  ```

> [!NOTE]
> Для работы в команде можно создать файл-пример (`config.sample.php`), который содержит ту же структуру, но без чувствительных данных. Разработчики смогут скопировать его и ввести свои значения локально.

Такой подход прост, удобен и надёжно работает во многих проектах, особенно на этапе обучения или в небольших приложениях.

### Хранение в .env файлах

> [!NOTE]
> Этот раздел является дополнительным и предназначен для тех, кто хочет углубить знания в вопросах конфигурации и безопасности.

Файл `.env` (от "environment" — окружение) используется для хранения конфиденциальной информации, такой как:

- логины и пароли,
- API-ключи,
- параметры подключения к БД,
- пути к файлам,
- переменные, зависящие от среды (dev/test/prod).

Это позволяет разделить конфигурацию и код, не размещая чувствительные данные в репозитории [^1].

#### Зачем нужен .env?

- Позволяет задавать параметры, специфичные для среды (например, разные базы данных для разработки и продакшена).
- Повышает безопасность: файл .env не должен попадать в систему контроля версий.
- Упрощает настройку: достаточно скопировать .env.example и ввести свои значения.

#### Пример содержимого .env:

```
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=password
DB_NAME=test
DB_CHARSET=utf8
```

#### Как использовать `.env` в PHP

По умолчанию PHP не умеет автоматически загружать `.env-файлы`. Для этого можно использовать библиотеку `vlucas/phpdotenv`, которая является стандартом де-факто во многих проектах.

**Установка (с помощью Composer)**:

```bash
composer require vlucas/phpdotenv
```

**Пример**. _Использование .env в PHP_

```php
<?php

require_once __DIR__ . '/vendor/autoload.php';

// Инициализация dotenv (файл .env должен быть в корне проекта)
$dotenv = Dotenv\Dotenv::createImmutable(__DIR__);
$dotenv->load();

// Получение переменных окружения
$dbHost = getenv('DB_HOST');
$dbName = getenv('DB_NAME');
$dbUser = getenv('DB_USER');
$dbPass = getenv('DB_PASSWORD');
```

После вызова `$dotenv->load()` библиотека:

- читает содержимое `.env`
- устанавливает пары ключ-значение как переменные окружения
- наполняет суперглобальные массивы `$_ENV` и `$_SERVER` (если это разрешено в `php.ini`).

> [!TIP]
> Если в `php.ini` указана директива `variables_order = "EGPCS"`, переменные окружения можно также получить через `$_ENV['DB_HOST']`. Однако во избежание проблем рекомендуется использовать `getenv()`.

#### Безопасность .env

- Всегда добавляйте файл `.env` в `.gitignore`:
  ```
  # .gitignore
  .env
  ```
- В репозитории можно оставить только `.env.example` — файл-шаблон со структурой, но без чувствительных данных. Это упростит настройку проекта для других разработчиков.

[^1]: _What is .env?_. codementor.io [online resource]. Available at: https://www.codementor.io/@parthibakumarmurugesan/what-is-env-how-to-set-up-and-run-a-env-file-in-node-1pnyxw9yxj
